(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function i(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=i(l);fetch(l.href,s)}})();let j=null;function gt(e){j=e}const ft="https://api.open-meteo.com/v1/forecast";async function wt(e){const n=await fetch(`https://nominatim.openstreetmap.org/search?q=${e}&format=json&addressdetails=1`);if(!n.ok)throw new Error(a("fetch_coords_error"));const i=await n.json();let o=null,l=1/0;for(const s of i){let c=1/0;s.class==="place"&&(s.type==="city"&&s.place_rank===15?c=15:s.type==="town"&&s.place_rank===16?c=16:s.type==="village"&&s.place_rank===17&&(c=17)),c<l&&(l=c,o=s)}if(!o)for(const s of i)s.class==="boundary"&&s.type==="administrative"&&(!o||s.place_rank<o.place_rank)&&(o=s);if(o)return{latitude:o.lat,longitude:o.lon,type:o.type,boundingbox:o.boundingbox||null};if(i.length>0)return{latitude:i[0].lat,longitude:i[0].lon,type:i[0].type,boundingbox:i[0].boundingbox||null};throw new Error(a("city_not_found_error"))}async function V(e,n){const i=`?latitude=${e}&longitude=${n}&current=temperature_2m,relative_humidity_2m,visibility,weather_code,is_day,wind_speed_10m&hourly=temperature_2m,weathercode,wind_speed_10m,relative_humidity_2m,visibility&daily=weathercode,temperature_2m_max,temperature_2m_min&forecast_days=7&timezone=auto`,o=await fetch(`${ft}${i}`);if(!o.ok)throw new Error(a("fetch_weather_error"));return await o.json()}async function ht(e,n){const i=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${n}&accept-language=en`);if(!i.ok)throw new Error(a("fetch_city_name_error"));const o=await i.json(),l=o.address.city||o.address.town||o.address.village||"Unknown Location",s=o.address.state||"",c=o.address.country||"";return{city:l,state:s,country:c}}const m={0:{day:"wi wi-day-sunny",night:"wi wi-night-clear"},1:{day:"wi wi-day-cloudy",night:"wi wi-night-alt-cloudy"},2:{day:"wi wi-cloud",night:"wi wi-cloud"},3:{day:"wi wi-cloudy",night:"wi wi-cloudy"},45:{day:"wi wi-day-fog",night:"wi wi-night-fog"},48:{day:"wi wi-day-fog",night:"wi wi-night-fog"},51:{day:"wi wi-day-sprinkle",night:"wi wi-night-alt-sprinkle"},53:{day:"wi wi-day-sprinkle",night:"wi wi-night-alt-sprinkle"},55:{day:"wi wi-day-showers",night:"wi wi-night-alt-showers"},56:{day:"wi wi-day-sleet",night:"wi wi-night-alt-sleet"},57:{day:"wi wi-day-sleet",night:"wi wi-night-alt-sleet"},61:{day:"wi wi-day-rain",night:"wi wi-night-alt-rain"},63:{day:"wi wi-day-rain",night:"wi wi-night-alt-rain"},65:{day:"wi wi-day-rain-wind",night:"wi wi-night-alt-rain-wind"},66:{day:"wi wi-day-sleet",night:"wi wi-night-alt-sleet"},67:{day:"wi wi-day-sleet",night:"wi wi-night-alt-sleet"},71:{day:"wi wi-day-snow",night:"wi wi-night-alt-snow"},73:{day:"wi wi-day-snow",night:"wi wi-night-alt-snow"},75:{day:"wi wi-day-snow-wind",night:"wi wi-night-alt-snow-wind"},77:{day:"wi wi-day-snow",night:"wi wi-night-alt-snow"},80:{day:"wi wi-day-showers",night:"wi wi-night-alt-showers"},81:{day:"wi wi-day-showers",night:"wi wi-night-alt-showers"},82:{day:"wi wi-day-thunderstorm",night:"wi wi-night-alt-thunderstorm"},85:{day:"wi wi-day-snow",night:"wi wi-night-alt-snow"},86:{day:"wi wi-day-snow-wind",night:"wi wi-night-alt-snow-wind"},95:{day:"wi wi-day-thunderstorm",night:"wi wi-night-alt-thunderstorm"},96:{day:"wi wi-day-thunderstorm",night:"wi wi-night-alt-thunderstorm"},99:{day:"wi wi-day-thunderstorm",night:"wi wi-night-alt-thunderstorm"}},W=document.getElementById("weather-main-content"),pt=document.getElementById("forecast-container"),Z=document.getElementById("location-info"),I=document.querySelector(".loader-container");let x;const G=()=>{I.classList.remove("hidden"),I.classList.add("flex")},$=()=>{I.classList.add("hidden"),I.classList.remove("flex")};async function Q(e,n){try{const i=await ht(e,n),o=[i.city,i.state,i.country].filter(Boolean).join(", ");Z.innerHTML=`<p class="text-gray-600 text-lg text-center font-semibold">üìç ${o}</p>`}catch(i){g(i.message)}}function g(e){W.innerHTML=`<div class="weather-info-container"><p class="text-red-500 font-bold text-center text-lg">${e}</p></div>`}function T(e){const n=new Date().getHours()>=6&&new Date().getHours()<18;return e>=0&&e<=1?"text-yellow-400":e>=2&&e<=3?"text-gray-400":e>=45&&e<=48?"text-gray-500":e>=51&&e<=67?"text-blue-500":e>=71&&e<=77?"text-white":e>=80&&e<=82?"text-blue-600":e>=85&&e<=86?"text-white":e>=95&&e<=99?"text-yellow-500":n?"text-gray-800":"text-gray-200"}function D(e){return e>=0&&e<=1?"#fcd34d":e>=2&&e<=3?"#9ca3af":e>=45&&e<=48?"#6b7280":e>=51&&e<=67?"#3b82f6":e>=71&&e<=77?"#ffffff":e>=80&&e<=82?"#2563eb":e>=85&&e<=86?"#ffffff":e>=95&&e<=99?"#f59e0b":"#e5e7eb"}function S(e,n){const i=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),l=parseInt(e.slice(5,7),16);return`rgba(${i}, ${o}, ${l}, ${n}`}function M(e){switch(e){case 0:return a("clear_sky");case 1:return a("mainly_clear");case 2:return a("partly_cloudy");case 3:return a("overcast");case 45:case 48:return a("fog");case 51:case 53:case 55:return a("drizzle");case 56:case 57:return a("freezing_drizzle");case 61:case 63:case 65:return a("rain");case 66:case 67:return a("freezing_rain");case 71:case 73:case 75:return a("snow_fall");case 77:return a("snow_grains");case 80:case 81:case 82:return a("rain_showers");case 85:case 86:return a("snow_showers");case 95:return a("thunderstorm");case 96:case 99:return a("thunderstorm_with_hail");default:return a("unknown_weather")}}function J(e){const n=document.getElementById("time-display");if(n&&e){const i=new Date,o={timeZone:e,hour:"numeric",minute:"numeric",hour12:!0};n.textContent=new Intl.DateTimeFormat("en-US",o).format(i)}}function z(e){gt(e);const n=L==="es"?"es-ES":"en-US";if(!e||!e.current||!e.daily){g(a("invalid_weather_data"));return}const i=e.current,o=i.is_day===1,l=m[i.weather_code]?o?m[i.weather_code].day:m[i.weather_code].night:"wi wi-na",s=T(i.weather_code),c=D(i.weather_code);let N,k;if(Array.isArray(e.boundingbox)&&e.boundingbox.length===4){const r=e.boundingbox,E=parseFloat(r[0]),y=parseFloat(r[1]),h=parseFloat(r[2]),p=parseFloat(r[3]);N=`${h},${E},${p},${y}`,k=`https://www.openstreetmap.org/export/embed.html?bbox=${N}&amp;layer=mapnik&amp;marker=${e.latitude},${e.longitude}`}else k=`https://www.openstreetmap.org/export/embed.html?bbox=${e.longitude-.1},${e.latitude-.1},${e.longitude+.1},${e.latitude+.1}&amp;layer=mapnik&amp;marker=${e.latitude},${e.longitude}`;const ot=`
        <div id="weather-info" class="weather-info-container animate__animated animate__fadeInUp" style="background-color: ${S(c,.4)};">
            <h2 class="text-3xl font-bold text-gray-700 text-center mb-2 animate-fade-in-slide-up" style="animation-delay: 0s;">${a("current_weather_title")}</h2>
            <p class="text-center text-gray-500 mb-4 animate-fade-in-slide-up" id="time-display" style="animation-delay: 0.1s;"></p>
            <div class="weather-icon-temp-container">
                <i class="${l} text-7xl ${s} animate__animated animate__fadeIn animate-fade-in-slide-up" style="animation-delay: 0.2s;"></i>
                <p class="text-5xl font-bold text-gray-800 animate-fade-in-slide-up" style="animation-delay: 0.3s;">${Math.round(i.temperature_2m)}¬∞C</p>
            </div>
            <p class="text-lg text-gray-600 text-center mt-2 animate-fade-in-slide-up" style="animation-delay: 0.4s;">${M(i.weather_code)}</p>
            <div class="weather-details mt-4 text-center flex justify-around items-start">
                <div class="detail-item flex flex-col items-center animate-fade-in-slide-up" style="animation-delay: 0.5s;">
                    <i class="wi wi-strong-wind text-2xl mb-1"></i>
                    <div class="text-gray-600 text-lg">${a("wind_speed_label")}</div>
                    <p class="text-gray-800 text-xl font-bold">${i.wind_speed_10m} ${a("unit_km_per_hour")}</p>
                </div>
                <div class="detail-item flex flex-col items-center animate-fade-in-slide-up" style="animation-delay: 0.6s;">
                    <i class="wi wi-humidity text-2xl mb-1"></i>
                    <div class="text-gray-600 text-lg">${a("humidity_label")}</div>
                    <p class="text-gray-800 text-xl font-bold">${i.relative_humidity_2m}${a("unit_percent")}</p>
                </div>
                <div class="detail-item flex flex-col items-center animate-fade-in-slide-up" style="animation-delay: 0.7s;">
                    <i class="wi wi-fog text-2xl mb-1"></i>
                    <div class="text-gray-600 text-lg">${a("visibility_label")}</div>
                    <p class="text-gray-800 text-xl font-bold">${i.visibility/1e3} ${a("unit_km")}</p>
                </div>
            </div>
        </div>
    `,rt=`
        <div id="map" class="animate__animated animate__fadeInUp">
            <iframe
                width="100%"
                height="400px"
                frameborder="0" style="border:0; border-radius: 16px;"
                src="${k}"
                allowfullscreen>
            </iframe>
        </div>
    `,u=e.hourly;let _=`<h3 class="col-span-full text-2xl font-bold text-gray-700 mb-4 text-center">${a("hourly_forecast_title")}</h3>`;const st=new Date().getHours(),d=u.time.findIndex(r=>new Date(r).getHours()===st),A=u.time.slice(d,d+4),f=u.weathercode.slice(d,d+4),lt=u.temperature_2m.slice(d,d+4),ct=u.wind_speed_10m.slice(d,d+4),dt=u.relative_humidity_2m.slice(d,d+4),ut=u.visibility.slice(d,d+4);for(let r=0;r<A.length;r++){const y=new Date(A[r]).toLocaleTimeString(n,{hour:"numeric",hour12:!0}),h=m[f[r]]?m[f[r]].day:"wi wi-na",p=T(f[r]),H=M(f[r]);_+=`
            <div class="forecast-item text-center transform transition-transform duration-300 hover:scale-105" style="background-color: ${S(D(f[r]),.4)}; justify-content: space-between; animation-delay: ${r*100}ms;">
                <p class="font-semibold text-gray-600 mb-2">${y}</p>
                <i class="${h} text-4xl ${p} my-2 animate__animated animate__fadeIn"></i>
                <p class="text-xs text-gray-500">${H}</p>
                <p class="text-sm text-gray-500">${Math.round(lt[r])}¬∞C</p>
                <div class="flex justify-center items-center text-xs text-gray-500 mt-1">
                    <i class="wi wi-strong-wind mr-1"></i> ${ct[r]} ${a("unit_km_per_hour")}
                </div>
                <div class="flex justify-center items-center text-xs text-gray-500">
                    <i class="wi wi-humidity mr-1"></i> ${dt[r]}${a("unit_percent")}
                </div>
                <div class="flex justify-center items-center text-xs text-gray-500">
                    <i class="wi wi-fog mr-1"></i> ${Math.round(ut[r]/1e3)} ${a("unit_km")}
                </div>
            </div>
        `}_=`<div class="hourly-forecast-container grid mt-8">${_}</div>`;const b=e.daily;let v=`<h3 class="col-span-full text-2xl font-bold text-gray-700 mb-4 text-center">${a("forecast_title")}</h3>`;const R=b.time.slice(1,5),w=b.weathercode.slice(1,5),mt=b.temperature_2m_max.slice(1,5),yt=b.temperature_2m_min.slice(1,5);for(let r=0;r<R.length;r++){const y=new Date(R[r]).toLocaleDateString(n,{weekday:"short"}),h=y.charAt(0).toUpperCase()+y.slice(1),p=m[w[r]]?m[w[r]].day:"wi wi-na",H=T(w[r]);v+=`
            <div class="forecast-item text-center transform transition-transform duration-300 hover:scale-105" style="background-color: ${S(D(w[r]),.4)}; animation-delay: ${r*100}ms;">
                <p class="font-semibold text-gray-600 mb-2">${h}</p>
                <i class="${p} text-4xl ${H} my-2 animate__animated animate__fadeIn"></i>
                <p class="text-xs text-gray-500">${M(w[r])}</p>
                <p class="text-sm text-gray-500">${Math.round(mt[r])}${a("unit_celsius")} / ${Math.round(yt[r])}${a("unit_celsius")}</p>
            </div>
        `}v=`<div class="daily-forecast-container grid mt-8">${v}</div>`,W.innerHTML=`
        <div class="flex flex-wrap -mx-2">
            <div class="w-full lg:w-1/2 px-2 mb-4">
                ${ot}
            </div>
            <div class="w-full lg:w-1/2 px-2 mb-4">
                ${rt}
            </div>
        </div>
        <div class="flex flex-wrap -mx-2">
            <div class="w-full lg:w-1/2 px-2 mb-4">
                ${_}
            </div>
            <div class="w-full lg:w-1/2 px-2 mb-4">
                ${v}
            </div>
        </div>
    `;const C=e.timezone;x&&clearInterval(x),J(C),x=setInterval(()=>J(C),6e4)}function U(){W.innerHTML="",pt.innerHTML="",Z.innerHTML="",x&&clearInterval(x)}const B=document.getElementById("search-history-container");function X(){return JSON.parse(localStorage.getItem("weatherSearchHistory"))||[]}function xt(e){localStorage.setItem("weatherSearchHistory",JSON.stringify(e))}function _t(e){let n=X();n=n.filter(i=>i.toLowerCase()!==e.toLowerCase()),n.unshift(e),n.length>5&&n.pop(),xt(n),Y()}function Y(){const e=X();if(B.innerHTML="",e.length>0){const n=document.createElement("h3");n.classList.add("text-lg","font-semibold","mb-2","text-gray-700","dark:text-gray-300"),n.textContent=a("recent_searches"),B.appendChild(n);const i=document.createElement("div");i.classList.add("flex","flex-wrap","gap-2"),e.forEach(o=>{const l=document.createElement("span");l.classList.add("cursor-pointer","py-1","px-3","bg-gray-200","dark:bg-gray-800","rounded-full","text-sm","text-gray-700","dark:text-gray-700","hover:bg-blue-500","dark:hover:bg-blue-400","hover:text-white","dark:hover:text-gray-100"),l.textContent=o,l.addEventListener("click",()=>{document.getElementById("city-input").value=o,document.getElementById("search-btn").click()}),i.appendChild(l)}),B.appendChild(i)}}function tt(){Y()}let L="en",et={};async function nt(e){try{const n=await fetch(`/${e}.json?v=${new Date().getTime()}`);if(!n.ok){console.error(`Could not load translation file for ${e}.`);return}et=await n.json(),bt()}catch(n){console.error("Error loading translations:",n)}}function a(e){return et[e]||e}function bt(){document.getElementById("page-title").textContent=a("page_title"),document.querySelector(".responsive-title").textContent=a("weather_app_title"),document.getElementById("city-input").placeholder=a("enter_city_placeholder"),document.querySelector("#search-btn span").textContent=a("search_button"),document.querySelector("#location-btn span").textContent=a("location_button"),document.getElementById("attribution-author").innerHTML=a("attribution_author"),document.querySelector('[data-i18n="osm_attribution"]').innerHTML='Data &copy; OpenStreetMap contributors, ODbL 1.0. <a href="http://osm.org/copyright" target="_blank" class="text-blue-500 hover:underline">http://osm.org/copyright</a>',j&&z(j),tt()}function vt(e){L=e;const n=document.getElementById("selected-lang-flag");e==="en"?n.src="https://flagcdn.com/w40/us.png":e==="es"&&(n.src="https://flagcdn.com/w40/es.png"),nt(L),document.getElementById("language-dropdown").classList.add("hidden")}const O=document.getElementById("theme-toggle"),K=document.querySelector("html"),$t='<i class="fas fa-sun"></i>',It='<i class="fas fa-moon"></i>';function F(e){e==="dark"?(K.classList.add("dark"),O.innerHTML=$t,localStorage.setItem("theme","dark")):(K.classList.remove("dark"),O.innerHTML=It,localStorage.setItem("theme","light"))}function Lt(){const e=localStorage.getItem("theme")||"light";F(e),O.addEventListener("click",()=>{const n=localStorage.getItem("theme");F(n==="dark"?"light":"dark")})}const q=document.getElementById("city-input"),kt=document.getElementById("search-btn"),Et=document.getElementById("location-btn"),it=document.getElementById("options-menu"),P=document.getElementById("language-dropdown");document.addEventListener("DOMContentLoaded",()=>{nt(L),Lt(),tt()});const at=async()=>{const e=q.value.trim();if(e){G(),U();try{const n=await wt(e),i=await V(n.latitude,n.longitude),o={...n,...i};z(o),await Q(n.latitude,n.longitude),_t(e)}catch(n){g(n.message)}finally{$()}}},Ht=async()=>{G(),U(),navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{const{latitude:n,longitude:i}=e.coords;try{const o=await V(n,i),s={...{latitude:n,longitude:i},...o};z(s),await Q(n,i)}catch(o){g(o.message)}finally{$()}},e=>{let n;switch(e.code){case 1:n=t("geolocation_permission_denied");break;case 2:n=t("geolocation_position_unavailable");break;case 3:n=t("geolocation_timeout");break;default:n=`${t("geolocation_error")}: ${e.message}`;break}g(n),$()}):(g(t("geolocation_not_supported")),$())};kt.addEventListener("click",at);Et.addEventListener("click",Ht);q.addEventListener("keydown",e=>{e.key==="Enter"&&at()});q.addEventListener("input",e=>{e.target.value.trim()===""&&U()});it.addEventListener("click",e=>{e.stopPropagation(),P.classList.toggle("hidden")});window.addEventListener("click",function(e){it.contains(e.target)||P.classList.add("hidden")});P.addEventListener("click",e=>{const n=e.target.closest("a");if(n){const i=n.dataset.lang;i&&vt(i)}});
