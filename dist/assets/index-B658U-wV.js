(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=a(o);fetch(o.href,c)}})();let F=null;function yt(e){F=e}async function pt(e){const n=await fetch(`https://nominatim.openstreetmap.org/search?q=${e}&format=json&addressdetails=1`);if(!n.ok)throw new Error(i("fetch_coords_error"));const a=await n.json();let r=null,o=1/0;for(const c of a){let l=1/0;c.class==="place"&&(c.type==="city"&&c.place_rank===15?l=15:c.type==="town"&&c.place_rank===16?l=16:c.type==="village"&&c.place_rank===17&&(l=17)),l<o&&(o=l,r=c)}if(!r)for(const c of a)c.class==="boundary"&&c.type==="administrative"&&(!r||c.place_rank<r.place_rank)&&(r=c);if(r)return{latitude:r.lat,longitude:r.lon,type:r.type,boundingbox:r.boundingbox||null};if(a.length>0)return{latitude:a[0].lat,longitude:a[0].lon,type:a[0].type,boundingbox:a[0].boundingbox||null};throw new Error(i("city_not_found_error"))}async function V(e,n){const a="https://api.open-meteo.com/v1/forecast",r=`?latitude=${e}&longitude=${n}&current=temperature_2m,relative_humidity_2m,visibility,weather_code,is_day,wind_speed_10m&hourly=temperature_2m,weathercode,wind_speed_10m,relative_humidity_2m,visibility&daily=weathercode,temperature_2m_max,temperature_2m_min&forecast_days=7&timezone=auto`,o=await fetch(`${a}${r}`);if(!o.ok)throw new Error(i("fetch_weather_error"));return await o.json()}async function gt(e,n){const a=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${n}&accept-language=en`);if(!a.ok)throw new Error(i("fetch_city_name_error"));const r=await a.json(),o=r.address.city||r.address.town||r.address.village||"Unknown Location",c=r.address.state||"",l=r.address.country||"";return{city:o,state:c,country:l}}const O=document.getElementById("weather-main-content"),ht=document.getElementById("forecast-container"),Z=document.getElementById("location-info"),$=document.querySelector(".loader-container");let x;const G=()=>{$.classList.remove("hidden"),$.classList.add("flex")},v=()=>{$.classList.add("hidden"),$.classList.remove("flex")};async function Q(e,n){try{const a=await gt(e,n),r=[a.city,a.state,a.country].filter(Boolean).join(", ");Z.innerHTML=`<p class="text-gray-600 text-lg text-center font-semibold">üìç ${r}</p>`}catch(a){f(a.message)}}function f(e){O.innerHTML=`<div class="weather-info-container"><p class="text-red-500 font-bold text-center text-lg">${e}</p></div>`}function H(e){const n=new Date().getHours()>=6&&new Date().getHours()<18;return e>=0&&e<=1?"text-yellow-400":e>=2&&e<=3?"text-gray-400":e>=45&&e<=48?"text-gray-500":e>=51&&e<=67?"text-blue-500":e>=71&&e<=77?"text-white":e>=80&&e<=82?"text-blue-600":e>=85&&e<=86?"text-white":e>=95&&e<=99?"text-yellow-500":n?"text-gray-800":"text-gray-200"}function T(e){return e>=0&&e<=1?"#fcd34d":e>=2&&e<=3?"#9ca3af":e>=45&&e<=48?"#6b7280":e>=51&&e<=67?"#3b82f6":e>=71&&e<=77?"#ffffff":e>=80&&e<=82?"#2563eb":e>=85&&e<=86?"#ffffff":e>=95&&e<=99?"#f59e0b":"#e5e7eb"}function D(e,n){const a=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return`rgba(${a}, ${r}, ${o}, ${n})`}function S(e){switch(e){case 0:return i("clear_sky");case 1:return i("mainly_clear");case 2:return i("partly_cloudy");case 3:return i("overcast");case 45:case 48:return i("fog");case 51:case 53:case 55:return i("drizzle");case 56:case 57:return i("freezing_drizzle");case 61:case 63:case 65:return i("rain");case 66:case 67:return i("freezing_rain");case 71:case 73:case 75:return i("snow_fall");case 77:return i("snow_grains");case 80:case 81:case 82:return i("rain_showers");case 85:case 86:return i("snow_showers");case 95:return i("thunderstorm");case 96:case 99:return i("thunderstorm_with_hail");default:return i("unknown_weather")}}function J(e){const n=document.getElementById("time-display");if(n&&e){const a=new Date,r={timeZone:e,hour:"numeric",minute:"numeric",hour12:!0};n.textContent=new Intl.DateTimeFormat("en-US",r).format(a)}}function W(e){yt(e);const n=I==="es"?"es-ES":"en-US";if(!e||!e.current||!e.daily){f(i("invalid_weather_data"));return}const a=e.current,r=a.is_day===1,o=weatherIcons[a.weather_code]?r?weatherIcons[a.weather_code].day:weatherIcons[a.weather_code].night:"wi wi-na",c=H(a.weather_code),l=T(a.weather_code);let P,L;if(Array.isArray(e.boundingbox)&&e.boundingbox.length===4){const s=e.boundingbox,k=parseFloat(s[0]),m=parseFloat(s[1]),g=parseFloat(s[2]),h=parseFloat(s[3]);P=`${g},${k},${h},${m}`,L=`https://www.openstreetmap.org/export/embed.html?bbox=${P}&amp;layer=mapnik&amp;marker=${e.latitude},${e.longitude}`}else L=`https://www.openstreetmap.org/export/embed.html?bbox=${e.longitude-.1},${e.latitude-.1},${e.longitude+.1},${e.latitude+.1}&amp;layer=mapnik&amp;marker=${e.latitude},${e.longitude}`;const rt=`
        <div id="weather-info" class="weather-info-container animate__animated animate__fadeInUp" style="background-color: ${D(l,.4)};">
            <h2 class="text-3xl font-bold text-gray-700 text-center mb-2 animate-fade-in-slide-up" style="animation-delay: 0s;">${i("current_weather_title")}</h2>
            <p class="text-center text-gray-500 mb-4 animate-fade-in-slide-up" id="time-display" style="animation-delay: 0.1s;"></p>
            <div class="weather-icon-temp-container">
                <i class="${o} text-7xl ${c} animate__animated animate__fadeIn animate-fade-in-slide-up" style="animation-delay: 0.2s;"></i>
                <p class="text-5xl font-bold text-gray-800 animate-fade-in-slide-up" style="animation-delay: 0.3s;">${Math.round(a.temperature_2m)}¬∞C</p>
            </div>
            <p class="text-lg text-gray-600 text-center mt-2 animate-fade-in-slide-up" style="animation-delay: 0.4s;">${S(a.weather_code)}</p>
            <div class="weather-details mt-4 text-center flex justify-around items-start">
                <div class="detail-item flex flex-col items-center animate-fade-in-slide-up" style="animation-delay: 0.5s;">
                    <i class="wi wi-strong-wind text-2xl mb-1"></i>
                    <div class="text-gray-600 text-lg">${i("wind_speed_label")}</div>
                    <p class="text-gray-800 text-xl font-bold">${a.wind_speed_10m} ${i("unit_km_per_hour")}</p>
                </div>
                <div class="detail-item flex flex-col items-center animate-fade-in-slide-up" style="animation-delay: 0.6s;">
                    <i class="wi wi-humidity text-2xl mb-1"></i>
                    <div class="text-gray-600 text-lg">${i("humidity_label")}</div>
                    <p class="text-gray-800 text-xl font-bold">${a.relative_humidity_2m}${i("unit_percent")}</p>
                </div>
                <div class="detail-item flex flex-col items-center animate-fade-in-slide-up" style="animation-delay: 0.7s;">
                    <i class="wi wi-fog text-2xl mb-1"></i>
                    <div class="text-gray-600 text-lg">${i("visibility_label")}</div>
                    <p class="text-gray-800 text-xl font-bold">${a.visibility/1e3} ${i("unit_km")}</p>
                </div>
            </div>
        </div>
    `,ot=`
        <div id="map">
            <iframe
                width="100%"
                height="400px"
                frameborder="0" style="border:0; border-radius: 16px;"
                src="${L}"
                allowfullscreen>
            </iframe>
        </div>
    `,u=e.hourly;let _=`<h3 class="col-span-full text-2xl font-bold text-gray-700 mb-4 text-center">${i("hourly_forecast_title")}</h3>`;const st=new Date().getHours(),d=u.time.findIndex(s=>new Date(s).getHours()===st),N=u.time.slice(d,d+4),y=u.weathercode.slice(d,d+4),ct=u.temperature_2m.slice(d,d+4),lt=u.wind_speed_10m.slice(d,d+4),dt=u.relative_humidity_2m.slice(d,d+4),ut=u.visibility.slice(d,d+4);for(let s=0;s<N.length;s++){const m=new Date(N[s]).toLocaleTimeString(n,{hour:"numeric",hour12:!0}),g=weatherIcons[y[s]]?weatherIcons[y[s]].day:"wi wi-na",h=H(y[s]),E=S(y[s]);_+=`
            <div class="forecast-item text-center transform transition-transform duration-300 hover:scale-105" style="background-color: ${D(T(y[s]),.4)}; justify-content: space-between; animation-delay: ${s*100}ms;">
                <p class="font-semibold text-gray-600 mb-2">${m}</p>
                <i class="${g} text-4xl ${h} my-2 animate__animated animate__fadeIn"></i>
                <p class="text-xs text-gray-500">${E}</p>
                <p class="text-sm text-gray-500">${Math.round(ct[s])}¬∞C</p>
                <div class="flex justify-center items-center text-xs text-gray-500 mt-1">
                    <i class="wi wi-strong-wind mr-1"></i> ${lt[s]} ${i("unit_km_per_hour")}
                </div>
                <div class="flex justify-center items-center text-xs text-gray-500">
                    <i class="wi wi-humidity mr-1"></i> ${dt[s]}${i("unit_percent")}
                </div>
                <div class="flex justify-center items-center text-xs text-gray-500">
                    <i class="wi wi-fog mr-1"></i> ${Math.round(ut[s]/1e3)} ${i("unit_km")}
                </div>
            </div>
        `}_=`<div class="hourly-forecast-container grid mt-8">${_}</div>`;const w=e.daily;let b=`<h3 class="col-span-full text-2xl font-bold text-gray-700 mb-4 text-center">${i("forecast_title")}</h3>`;const A=w.time.slice(1,5),p=w.weathercode.slice(1,5),mt=w.temperature_2m_max.slice(1,5),ft=w.temperature_2m_min.slice(1,5);for(let s=0;s<A.length;s++){const m=new Date(A[s]).toLocaleDateString(n,{weekday:"short"}),g=m.charAt(0).toUpperCase()+m.slice(1),h=weatherIcons[p[s]]?weatherIcons[p[s]].day:"wi wi-na",E=H(p[s]);b+=`
            <div class="forecast-item text-center transform transition-transform duration-300 hover:scale-105" style="background-color: ${D(T(p[s]),.4)}; animation-delay: ${s*100}ms;">
                <p class="font-semibold text-gray-600 mb-2">${g}</p>
                <i class="${h} text-4xl ${E} my-2 animate__animated animate__fadeIn"></i>
                <p class="text-xs text-gray-500">${S(p[s])}</p>
                <p class="text-sm text-gray-500">${Math.round(mt[s])}${i("unit_celsius")} / ${Math.round(ft[s])}${i("unit_celsius")}</p>
            </div>
        `}b=`<div class="daily-forecast-container grid mt-8">${b}</div>`,O.innerHTML=`
        <div class="flex flex-wrap -mx-2">
            <div class="w-full lg:w-1/2 px-2 mb-4">
                ${rt}
            </div>
            <div class="w-full lg:w-1/2 px-2 mb-4">
                ${ot}
            </div>
        </div>
        <div class="flex flex-wrap -mx-2">
            <div class="w-full lg:w-1/2 px-2 mb-4">
                ${_}
            </div>
            <div class="w-full lg:w-1/2 px-2 mb-4">
                ${b}
            </div>
        </div>
    `;const R=document.getElementById("map");R.querySelector("iframe").addEventListener("load",()=>{R.classList.add("animate__animated","animate__fadeInUp")});const C=e.timezone;x&&clearInterval(x),J(C),x=setInterval(()=>J(C),6e4)}function z(){O.innerHTML="",ht.innerHTML="",Z.innerHTML="",x&&clearInterval(x)}const M=document.getElementById("search-history-container");function X(){return JSON.parse(localStorage.getItem("weatherSearchHistory"))||[]}function xt(e){localStorage.setItem("weatherSearchHistory",JSON.stringify(e))}function _t(e){let n=X();n=n.filter(a=>a.toLowerCase()!==e.toLowerCase()),n.unshift(e),n.length>5&&n.pop(),xt(n),Y()}function Y(){const e=X();if(M.innerHTML="",e.length>0){const n=document.createElement("h3");n.classList.add("text-lg","font-semibold","mb-2","text-gray-700","dark:text-gray-300"),n.textContent=i("recent_searches"),M.appendChild(n);const a=document.createElement("div");a.classList.add("flex","flex-wrap","gap-2"),e.forEach(r=>{const o=document.createElement("span");o.classList.add("cursor-pointer","py-1","px-3","bg-gray-200","dark:bg-gray-800","rounded-full","text-sm","text-gray-700","dark:text-gray-700","hover:bg-blue-500","dark:hover:bg-blue-400","hover:text-white","dark:hover:text-gray-100"),o.textContent=r,o.addEventListener("click",()=>{document.getElementById("city-input").value=r,document.getElementById("search-btn").click()}),a.appendChild(o)}),M.appendChild(a)}}function tt(){Y()}let I="en",et={};async function nt(e){try{const n=await fetch(`/${e}.json?v=${new Date().getTime()}`);if(!n.ok){console.error(`Could not load translation file for ${e}.`);return}et=await n.json(),wt()}catch(n){console.error("Error loading translations:",n)}}function i(e){return et[e]||e}function wt(){document.getElementById("page-title").textContent=i("page_title"),document.querySelector(".responsive-title").textContent=i("weather_app_title"),document.getElementById("city-input").placeholder=i("enter_city_placeholder"),document.querySelector("#search-btn span").textContent=i("search_button"),document.querySelector("#location-btn span").textContent=i("location_button"),document.getElementById("attribution-author").innerHTML=i("attribution_author"),document.querySelector('[data-i18n="osm_attribution"]').innerHTML='Data &copy; OpenStreetMap contributors, ODbL 1.0. <a href="http://osm.org/copyright" target="_blank" class="text-blue-500 hover:underline">http://osm.org/copyright</a>',F&&W(F),tt()}function bt(e){I=e;const n=document.getElementById("selected-lang-flag");e==="en"?n.src="https://flagcdn.com/w40/us.png":e==="es"&&(n.src="https://flagcdn.com/w40/es.png"),nt(I),document.getElementById("language-dropdown").classList.add("hidden")}const j=document.getElementById("theme-toggle"),K=document.querySelector("html"),vt='<i class="fas fa-sun"></i>',$t='<i class="fas fa-moon"></i>';function B(e){e==="dark"?(K.classList.add("dark"),j.innerHTML=vt,localStorage.setItem("theme","dark")):(K.classList.remove("dark"),j.innerHTML=$t,localStorage.setItem("theme","light"))}function It(){const e=localStorage.getItem("theme")||"light";B(e),j.addEventListener("click",()=>{const n=localStorage.getItem("theme");B(n==="dark"?"light":"dark")})}const q=document.getElementById("city-input"),Lt=document.getElementById("search-btn"),kt=document.getElementById("location-btn"),at=document.getElementById("options-menu"),U=document.getElementById("language-dropdown");document.addEventListener("DOMContentLoaded",()=>{nt(I),It(),tt()});const it=async()=>{const e=q.value.trim();if(e){G(),z();try{const n=await pt(e),a=await V(n.latitude,n.longitude),r={...n,...a};W(r),await Q(n.latitude,n.longitude),_t(e)}catch(n){f(n.message)}finally{v()}}},Et=async()=>{G(),z(),navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{const{latitude:n,longitude:a}=e.coords;try{const r=await V(n,a),c={...{latitude:n,longitude:a},...r};W(c),await Q(n,a)}catch(r){f(r.message)}finally{v()}},e=>{let n;switch(e.code){case 1:n=t("geolocation_permission_denied");break;case 2:n=t("geolocation_position_unavailable");break;case 3:n=t("geolocation_timeout");break;default:n=`${t("geolocation_error")}: ${e.message}`;break}f(n),v()}):(f(t("geolocation_not_supported")),v())};Lt.addEventListener("click",it);kt.addEventListener("click",Et);q.addEventListener("keydown",e=>{e.key==="Enter"&&it()});q.addEventListener("input",e=>{e.target.value.trim()===""&&z()});at.addEventListener("click",e=>{e.stopPropagation(),U.classList.toggle("hidden")});window.addEventListener("click",function(e){at.contains(e.target)||U.classList.add("hidden")});U.addEventListener("click",e=>{const n=e.target.closest("a");if(n){const a=n.dataset.lang;a&&bt(a)}});
